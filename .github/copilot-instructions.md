# Copilot Agent Onboarding

## Quick Reference

- **Purpose**: SolidJS + TanStack Router/Query UI that ingests DiscGolfMetrix HTML pages, parses competition data, and renders list/detail dashboards. Includes custom minimal module loader tooling for non-module environments.
- **Stack**: Node 24.x (per CI), pnpm 10.8, Vite 7, SolidJS 1.9, TanStack Router/Query 1.x/5.x, Tailwind CSS 4 beta with biome for lint/format. TypeScript everywhere.
- **Repo size**: ~200 source files. Key code in `src/` (routes, queries, components); tooling/scripts under `scripts/` and root configs.

## Tooling & Commands

Always run commands from the repo root (`C:\Projects\Personal\project-cactus-byte`). Use pnpm (lockfile checked in).

| Step                | Command                                                   | Status & Notes                                                                                                                                                                                                                                                        |
| ------------------- | --------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Bootstrap**       | `pnpm install`                                            | Succeeds in ~3s with pnpm 10.8, no extra flags needed. Must be run after cloning or when deps change.                                                                                                                                                                 |
| **Dev server**      | `pnpm dev -- --open`                                      | Starts Vite on port 3000 (solid config). Use `--host` for LAN testing.                                                                                                                                                                                                |
| **Build**           | `pnpm build`                                              | Passes (≈11s). Outputs to `dist/`, including `entryPoint.js` and hashed asset bundles.                                                                                                                                                                                |
| **Postprocess**     | `pnpm build && pnpm build:postprocess [--prefix-url=...]` | `build:postprocess` rewrites bundle exports/imports for the custom module loader. Run only after a successful `pnpm build`. Optional `--prefix-url` injects CDN base.                                                                                                 |
| **Preview**         | `pnpm serve`                                              | Serves `dist/` using Vite preview (honors build output).                                                                                                                                                                                                              |
| **Format**          | `pnpm format`                                             | Runs `biome format` (safe).                                                                                                                                                                                                                                           |
| **Lint**            | `pnpm lint`                                               | Currently **fails**: Biome flags Tailwind CSS at-rules (`@plugin`, `@apply`, etc.) and various TODO-level issues (unused signals, missing `button` types). Expect to fix or suppress before committing. Consider `biome lint --max-diagnostics=0` for limited output. |
| **Type/lint combo** | `pnpm check`                                              | Equivalent to `biome check`; inherits the same lint failures.                                                                                                                                                                                                         |
| **Tests**           | `pnpm test`                                               | Fails: `'vitest' is not recognized`. No Vitest dependency installed. Add `vitest` (and config) before relying on this command.                                                                                                                                        |

### Command gotchas

- Biome is strict. Tailwind 4 beta directives are not yet recognized; update Biome config or exclude `styles.css` when necessary.
- `routeTree.gen.ts` is auto-generated by `@tanstack/router-plugin`. Avoid manual edits; regenerate via Vite dev/build when route files change.
- Postprocess script mutates files in `dist/assets/`; rerun build before invoking to avoid stale transforms.

## Architecture & Layout

- **Entry & boot**: `index.html` mounts `src/entryPoint.ts`, which lazy-loads `src/main.tsx`. Main registers TanStack Router with custom search-parameter history (`src/lib/routerSearchParamHistory.ts`).
- **Routing**: File-based routes in `src/routes/` (`__root.tsx`, `index.tsx`, `competition-list.tsx`, `competition.$competitionId.tsx`, etc.). Route tree autogen file lives at `src/routeTree.gen.ts`.
- **Data fetching/parsing**:
  - `src/queries/useCompetitionList.ts` scrapes HTML list views into `Event`/`League` models.
  - `src/queries/useCompetition.ts` fetches competition detail pages and returns identifier-first data (IDs for competitions, courses, players, plus action metadata).
  - `src/queries/useCompetitionHome.ts` and `useCompetitionData.ts` hold experimental parsers with TODOs.
  - `src/exampleResponses/` contains saved HTML samples for parser fixtures.
- **UI components**: `src/components/ui/` houses Tailwind-based primitives (`button.tsx`, `table.tsx`, etc.), while `src/components/Header.tsx` renders the slide-out navigation.
- **Integrations**: `src/integrations/tanstack-query/provider.tsx` wires QueryClient. Additional integration stubs in same folder.
- **Utilities**: `src/lib/utils.ts` (Tailwind merge helper). `src/minimal-module-loader.ts` is a TypeScript version of the browser module loader; `scripts/minimal-module-loader.js` is a debugging/prototype variant.
- **Configs**: `vite.config.ts`, `tsconfig.json`, `biome.json`, `ui.config.json`, `.github/workflows/build-and-deploy-gh-pages.yml`.
- **Static/public**: `public/manifest.json`, `public/robots.txt`. `dist/` is build output (ignored in commits).
- **Repo root highlights**: `package.json`, `pnpm-lock.yaml`, `README.md` placeholder, `scripts/`, `plugins/` (currently empty), `.tanstack/` temp artifacts, `.vscode/` editor hints, `.cta.json` for agent metadata.

## CI & Validation

- GitHub Actions workflow `build-and-deploy-gh-pages.yml` runs on pushes to `main`: installs pnpm, uses Node 24, runs `pnpm build`, and deploys `dist/` to `gh-pages` (with tagging logic). No automated lint/test step runs in CI—ensure local checks before pushing.
- No pre-commit hooks configured. Treat `pnpm build` + addressing Biome diagnostics as the minimum validation before opening PRs.

## Development Notes

- Tailwind v4 beta features (`@plugin`, `@custom-variant`, `@theme`, `@apply`) currently confuse Biome. Either expect lint noise or expand `biome.json` ignore rules when editing `src/styles.css`.
- Several files contain TODO placeholders (e.g., `_useCompetitionSearch` in `useCompetitionHome.ts`, `Header` unused signals). Clean up or underscore unused identifiers to quiet lint.
- `src/components/Header.tsx` uses slide-out state without type qualifiers; ensure button elements declare `type="button"` to satisfy lint.
- DOM parsing code relies on DiscGolfMetrix markup conventions. Reuse helpers (`extractCompetitionIdFromHref`, etc.) and consult sample HTML in `src/exampleResponses/` before adjusting selectors.
- Minimal module loader scripts are intentionally verbose; changes can break downstream consumers relying on transformed exports/imports.

## Usage Guidance for Future Agents

Follow the steps above verbatim before attempting alternative commands. Trust these instructions and only fall back to repo searches or new commands if the documented guidance is incomplete or produces unexpected results.
