import{c as r,m as x,I as W,a as ce,b as de,d as T,e as O,f as p,u as ue,g as q,o as A,s as D,h as ge,i as G,j as me,S as C,k as Ie,l as Te,n as De,t as P,p as s,F as z,L as Fe}from"./main-BqNCW6Oc.js";import{m as F,c as pe,P as V,a as Ne,b as fe,_ as Me,d as Q,e as Le,B as R,T as Oe,f as qe,g as J,h as ne,i as Ee,j as Re,k as U,l as ve}from"./table-VDLI2UgR.js";import"../entryPoint.js";import"./index-o-WvA1Gw.js";var Be=[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Ae=e=>r(W,x(e,{iconNode:Be,name:"clock"})),he=Ae,Ve=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],je=e=>r(W,x(e,{iconNode:Ve,name:"map-pin"})),He=je,ze=[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]],Ke=e=>r(W,x(e,{iconNode:ze,name:"message-circle"})),be=Ke,Ue=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],We=e=>r(W,x(e,{iconNode:Ue,name:"users"})),ye=We;function K(e){return n=>(e(n),()=>e(void 0))}var Ye=["id","name","validationState","required","disabled","readOnly"];function Ge(e){const n=`form-control-${de()}`,t=F({id:n},e),[o,a]=T(),[c,d]=T(),[i,m]=T(),[g,h]=T(),w=(I,L,u)=>{const S=u!=null||o()!=null;return[u,o(),S&&L!=null?I:void 0].filter(Boolean).join(" ")||void 0},v=I=>[i(),g(),I].filter(Boolean).join(" ")||void 0,y=O(()=>({"data-valid":p(t.validationState)==="valid"?"":void 0,"data-invalid":p(t.validationState)==="invalid"?"":void 0,"data-required":p(t.required)?"":void 0,"data-disabled":p(t.disabled)?"":void 0,"data-readonly":p(t.readOnly)?"":void 0}));return{formControlContext:{name:()=>p(t.name)??p(t.id),dataset:y,validationState:()=>p(t.validationState),isRequired:()=>p(t.required),isDisabled:()=>p(t.disabled),isReadOnly:()=>p(t.readOnly),labelId:o,fieldId:c,descriptionId:i,errorMessageId:g,getAriaLabelledBy:w,getAriaDescribedBy:v,generateId:pe(()=>p(t.id)),registerLabel:K(a),registerField:K(d),registerDescription:K(m),registerErrorMessage:K(h)}}}var xe=ce();function j(){const e=ue(xe);if(e===void 0)throw new Error("[kobalte]: `useFormControlContext` must be used within a `FormControlContext.Provider` component");return e}function _e(e){const n=j(),t=F({id:n.generateId("description")},e);return q(()=>A(n.registerDescription(t.id))),r(V,x({as:"div"},()=>n.dataset(),t))}var Qe=["id","aria-label","aria-labelledby","aria-describedby"];function Je(e){const n=j(),t=F({id:n.generateId("field")},e);return q(()=>A(n.registerField(p(t.id)))),{fieldProps:{id:()=>p(t.id),ariaLabel:()=>p(t["aria-label"]),ariaLabelledBy:()=>n.getAriaLabelledBy(p(t.id),p(t["aria-label"]),p(t["aria-labelledby"])),ariaDescribedBy:()=>n.getAriaDescribedBy(p(t["aria-describedby"]))}}}function X(e){let n;const t=j(),o=F({id:t.generateId("label")},e),[a,c]=D(o,["ref"]),d=Ne(()=>n,()=>"label");return q(()=>A(t.registerLabel(c.id))),r(V,x({as:"label",ref(i){var m=G(g=>n=g,a.ref);typeof m=="function"&&m(i)},get for(){return ge(()=>d()==="label")()?t.fieldId():void 0}},()=>t.dataset(),c))}function Xe(e,n){q(me(e,t=>{if(t==null)return;const o=Ze(t);o!=null&&(o.addEventListener("reset",n,{passive:!0}),A(()=>{o.removeEventListener("reset",n)}))}))}function Ze(e){return et(e)?e.form:e.closest("form")}function et(e){return e.matches("textarea, input, select, button")}function Ce(e){const n=j(),t=F({id:n.generateId("error-message")},e),[o,a]=D(t,["forceMount"]),c=()=>n.validationState()==="invalid";return q(()=>{c()&&A(n.registerErrorMessage(a.id))}),r(C,{get when(){return o.forceMount||c()},get children(){return r(V,x({as:"div"},()=>n.dataset(),a))}})}function tt(e){const[n,t]=T(e.defaultValue?.()),o=O(()=>e.value?.()!==void 0),a=O(()=>o()?e.value?.():n());return[a,d=>{Ie(()=>{const i=Te(d,a());return Object.is(i,a())||(o()||t(i),e.onChange?.(i)),i})}]}var nt={};Me(nt,{Description:()=>_e,ErrorMessage:()=>Ce,Input:()=>ee,Label:()=>X,Root:()=>te,TextArea:()=>$e,TextField:()=>at,useTextFieldContext:()=>Z});var we=ce();function Z(){const e=ue(we);if(e===void 0)throw new Error("[kobalte]: `useTextFieldContext` must be used within a `TextField` component");return e}function ee(e){return r(Se,x({type:"text"},e))}function Se(e){const n=j(),t=Z(),o=F({id:t.generateId("input")},e),[a,c,d]=D(o,["onInput"],Qe),{fieldProps:i}=Je(c);return r(V,x({as:"input",get id(){return i.id()},get name(){return n.name()},get value(){return t.value()},get required(){return n.isRequired()},get disabled(){return n.isDisabled()},get readonly(){return n.isReadOnly()},get"aria-label"(){return i.ariaLabel()},get"aria-labelledby"(){return i.ariaLabelledBy()},get"aria-describedby"(){return i.ariaDescribedBy()},get"aria-invalid"(){return n.validationState()==="invalid"||void 0},get"aria-required"(){return n.isRequired()||void 0},get"aria-disabled"(){return n.isDisabled()||void 0},get"aria-readonly"(){return n.isReadOnly()||void 0},get onInput(){return fe([a.onInput,t.onInput])}},()=>n.dataset(),d))}function te(e){let n;const t=`textfield-${de()}`,o=F({id:t},e),[a,c,d]=D(o,["ref","value","defaultValue","onChange"],Ye),i=a.value,[m,g]=tt({value:()=>i===void 0?void 0:a.value??"",defaultValue:()=>a.defaultValue,onChange:y=>a.onChange?.(y)}),{formControlContext:h}=Ge(c);Xe(()=>n,()=>g(a.defaultValue??""));const w=y=>{if(h.isReadOnly()||h.isDisabled())return;const _=y.target;g(_.value),_.value=m()??""},v={value:m,generateId:pe(()=>p(c.id)),onInput:w};return r(xe.Provider,{value:h,get children(){return r(we.Provider,{value:v,get children(){return r(V,x({as:"div",ref(y){var _=G(I=>n=I,a.ref);typeof _=="function"&&_(y)},role:"group",get id(){return p(c.id)}},()=>h.dataset(),d))}})}})}function $e(e){let n;const t=Z(),o=F({id:t.generateId("textarea")},e),[a,c]=D(o,["ref","autoResize","submitOnEnter","onKeyPress"]);q(me([()=>n,()=>a.autoResize,()=>t.value()],([i,m])=>{!i||!m||rt(i)}));const d=i=>{n&&a.submitOnEnter&&i.key==="Enter"&&!i.shiftKey&&n.form&&(n.form.requestSubmit(),i.preventDefault())};return r(Se,x({as:"textarea",get"aria-multiline"(){return a.submitOnEnter?"false":void 0},get onKeyPress(){return fe([a.onKeyPress,d])},ref(i){var m=G(g=>n=g,a.ref);typeof m=="function"&&m(i)}},c))}function rt(e){const n=e.style.alignSelf,t=e.style.overflow;"MozAppearance"in e.style||(e.style.overflow="hidden"),e.style.alignSelf="start",e.style.height="auto",e.style.height=`${e.scrollHeight+(e.offsetHeight-e.clientHeight)}px`,e.style.overflow=t,e.style.alignSelf=n}var at=Object.assign(te,{Description:_e,ErrorMessage:Ce,Input:ee,Label:X,TextArea:$e});const re=e=>{const[n,t]=D(e,["class"]);return r(te,x({get class(){return Q("flex flex-col gap-1",n.class)}},t))},ae=e=>{const n=x({type:"text"},e),[t,o]=D(n,["type","class"]);return r(ee,x({get type(){return t.type},get class(){return Q("flex h-10 w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[invalid]:border-error-foreground data-[invalid]:text-error-foreground",t.class)}},o))},ot=Le("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",{variants:{variant:{label:"data-[invalid]:text-destructive",description:"font-normal text-muted-foreground",error:"text-xs text-destructive"}},defaultVariants:{variant:"label"}}),oe=e=>{const[n,t]=D(e,["class"]);return r(X,x({get class(){return Q(ot(),n.class)}},t))};async function it(e={from:1,to:30}){const n=new URL("https://discgolfmetrix.com/competitions_server.php"),t=n.searchParams;e.name!==void 0&&t.append("name",e.name),e.date1&&t.append("date1",e.date1),e.date2&&t.append("date2",e.date2),e.registrationDate1&&t.append("registration_date1",e.registrationDate1),e.registrationDate2&&t.append("registration_date2",e.registrationDate2),e.registrationOpen&&t.append("registration_open",e.registrationOpen),e.registrationWillOpen&&t.append("registration_will_open",e.registrationWillOpen),e.countryCode&&t.append("country_code",e.countryCode),e.clubId&&(t.append("clubid",e.clubId),e.clubType&&t.append("clubtype",e.clubType)),e.associationId&&t.append("association_id",e.associationId),e.courseId&&t.append("course_id",e.courseId),e.closeToMe&&(t.append("close_to_me",e.closeToMe),e.lat&&t.append("lat",e.lat),e.lng&&t.append("lng",e.lng)),e.area&&t.append("area",e.area),e.city&&t.append("city",e.city),e.division&&t.append("division",e.division),e.my&&t.append("my",e.my),e.myAll&&t.append("my_all",e.myAll),e.type&&t.append("type",e.type),e.view&&t.append("view",e.view),e.sortName&&t.append("sort_name",e.sortName),e.sortOrder&&t.append("sort_order",e.sortOrder),t.append("from",String(e.from)),t.append("to",String(e.to)),t.append("page",e.page??"all");const a=await(await fetch(n)).text(),d=new DOMParser().parseFromString(a,"text/html");return{competitions:st(d),pagination:lt(d)}}function st(e){const n=[],t=e.querySelectorAll(".column a.gridlist");for(const o of t){const a=o.querySelector("section");if(!a)continue;const d=(o.getAttribute("href")||"").replace(/^\//,""),i=a.querySelector("h2")?.textContent?.trim()||"",g=a.querySelector(".wrapper-competition-type .competition-type")?.textContent?.trim(),h=a.querySelectorAll(".metadata-list li");let w,v,y,_="event",I,L,u,S,b;for(const k of h){const $=k.textContent?.trim()||"";if(k.querySelector(".fi-clock")){const l=$.replace(/\u2013|\u2014/g,"-").trim(),f=l.match(/(.+?)\s*-\s*(.+)/);if(f){const N=new Date(f[1].trim()),E=new Date(f[2].trim());if(!Number.isNaN(N.getTime())&&!Number.isNaN(E.getTime()))v=N.getTime(),y=E.getTime(),_="league";else{const H=new Date(l);Number.isNaN(H.getTime())||(w=H.getTime())}}else{const N=new Date(l);Number.isNaN(N.getTime())||(w=N.getTime())}}else if(k.querySelector('svg use[*|href="#icon_flag_triangle"]'))I=$;else if(k.querySelector('svg use[*|href="#icon_location"]'))L=$;else if(k.querySelector('svg use[*|href="#icon_group"]')){const l=$.match(/Players:\s*(\d+)/);l&&(u=Number.parseInt(l[1],10))}else k.querySelector(".fi-list-thumbnails")?S=$:k.querySelector('svg use[*|href="#icon_speech"]')&&(b=$)}_==="league"&&v!==void 0&&y!==void 0?n.push({id:d,name:i,type:g,itemType:_,rangeStart:v,rangeEnd:y,playerCount:u,comments:b}):_==="event"&&w!==void 0&&n.push({id:d,name:i,type:g,itemType:_,timestamp:w,course:I,location:L,playerCount:u,registrationStatus:S,comments:b})}return n}function lt(e){const n=e.querySelector(".pagination");if(!n)return{currentPage:1,hasPrevious:!1,hasNext:!1};const t=n.querySelector(".current"),o=t?Number.parseInt(t.textContent?.trim()||"1",10):1,a=n.querySelector(".pagination-previous"),c=a&&!a.classList.contains("disabled"),d=n.querySelector(".pagination-next"),i=d&&!d.classList.contains("disabled");return{currentPage:o,hasPrevious:!!c,hasNext:!!i}}function ct(e){return De(()=>{const n=e();return{queryKey:["competitions","list",n],queryFn:({pageParam:t})=>it({...n,from:t.from,to:t.to}),initialPageParam:{from:1,to:30},getNextPageParam:(t,o,a)=>{if(t.pagination.hasNext)return{from:a.to+1,to:a.to+30}},getPreviousPageParam:(t,o,a)=>{if(!(a.from<=1))return{from:Math.max(1,a.from-30),to:a.from-1}},staleTime:1e3*60}})}var ie=P('<div class="flex flex-wrap gap-2">'),dt=P('<div class="flex flex-wrap items-end gap-4">'),ut=P("<div>Loading competitions…"),gt=P("<div class=text-red-600>Error loading competitions"),mt=P("<div class=text-sm>Loading more…"),pt=P('<div class=p-4><h1 class="text-2xl font-semibold mb-4">Competitions</h1><div class="mb-6 flex flex-col gap-4"><div class="flex flex-wrap gap-2"></div></div><div class="flex items-center gap-3 mt-4">'),ft=P('<div class="text-sm text-muted-foreground">Showing competitions from <span class=font-medium></span> to <span class=font-medium>'),vt=P('<div class="text-sm text-muted">&nbsp;'),ht=P("<span>•"),bt=P('<div class="flex flex-col gap-1"><div class="text-lg font-medium"></div><div class="text-sm flex gap-1 items-center"><span></span></div><div class="text-sm flex gap-1 items-center"><span></span><span></span></div><div class="text-sm flex gap-1 items-center"><span>'),Pe=P('<div class="text-sm flex gap-1 items-center"><span>'),yt=P('<div class="flex flex-col gap-1"><div class="text-lg font-medium"></div><div class="text-sm flex gap-1 items-center"><span> - </span></div><div class="text-sm flex gap-1 items-center"><span>');const xt=[{value:"upcoming",label:"Upcoming"},{value:"past",label:"Past"},{value:"custom",label:"Custom"}],_t=[{value:"today",label:"Today"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"year",label:"Year"}],Ct=[{value:"yesterday",label:"Yesterday"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"year",label:"Year"}],Y=e=>new Date(e.getFullYear(),e.getMonth(),e.getDate()),B=e=>{const n=e.getFullYear(),t=`${e.getMonth()+1}`.padStart(2,"0"),o=`${e.getDate()}`.padStart(2,"0");return`${n}-${t}-${o}`},M=(e,n)=>{const t=new Date(e);return t.setDate(t.getDate()+n),Y(t)},se=e=>{const n=Y(new Date);let t;switch(e){case"today":t=n;break;case"week":t=M(n,6);break;case"month":t=M(n,29);break;case"year":t=M(n,364);break;default:t=n}return{start:B(n),end:B(t)}},le=e=>{const n=Y(new Date),t=M(n,-1);let o;switch(e){case"yesterday":o=t;break;case"week":o=M(t,-6);break;case"month":o=M(t,-29);break;case"year":o=M(t,-364);break;default:o=t}return{start:B(o),end:B(t)}};function Tt(){const e=B(Y(new Date)),[n,t]=T("upcoming"),[o,a]=T("month"),[c,d]=T("month"),[i,m]=T(e),[g,h]=T(e),w=O(()=>{const u=n();if(u==="custom"){const b=i(),k=g();return{date1:b||void 0,date2:k||void 0}}if(u==="upcoming"){const b=se(o());return{date1:b.start,date2:b.end}}const S=le(c());return{date1:S.start,date2:S.end}}),v=ct(w),y=u=>{m(u),u&&g()&&u>g()&&h(u)},_=u=>{h(u),u&&i()&&u<i()&&m(u)},I=O(()=>i()!==e||g()!==e),L=O(()=>{const u=n();if(u==="custom"){const S=i(),b=g();return!S||!b?void 0:{start:S,end:b}}return u==="upcoming"?se(o()):le(c())});return(()=>{var u=pt(),S=u.firstChild,b=S.nextSibling,k=b.firstChild,$=b.nextSibling;return s(k,r(z,{each:xt,children:l=>r(R,{type:"button",get variant(){return n()===l.value?"default":"outline"},class:"h-9 px-3 capitalize",get"aria-pressed"(){return n()===l.value},onClick:()=>t(l.value),get children(){return l.label}})})),s(b,r(C,{get when(){return n()==="upcoming"},get children(){var l=ie();return s(l,r(z,{each:_t,children:f=>r(R,{type:"button",get variant(){return o()===f.value?"default":"outline"},class:"h-9 px-3 capitalize",get"aria-pressed"(){return o()===f.value},onClick:()=>a(f.value),get children(){return f.label}})})),l}}),null),s(b,r(C,{get when(){return n()==="past"},get children(){var l=ie();return s(l,r(z,{each:Ct,children:f=>r(R,{type:"button",get variant(){return c()===f.value?"default":"outline"},class:"h-9 px-3 capitalize",get"aria-pressed"(){return c()===f.value},onClick:()=>d(f.value),get children(){return f.label}})})),l}}),null),s(b,r(C,{get when(){return n()==="custom"},get children(){var l=dt();return s(l,r(re,{class:"w-full sm:w-48",get children(){return[r(oe,{for:"competition-custom-start",children:"Start date"}),r(ae,{id:"competition-custom-start",type:"date",get max(){return g()||void 0},get value(){return i()},onChange:f=>y(f.currentTarget.value)})]}}),null),s(l,r(re,{class:"w-full sm:w-48",get children(){return[r(oe,{for:"competition-custom-end",children:"End date"}),r(ae,{id:"competition-custom-end",type:"date",get min(){return i()||void 0},get value(){return g()},onChange:f=>_(f.currentTarget.value)})]}}),null),s(l,r(R,{type:"button",variant:"outline",class:"h-10",get disabled(){return!I()},onClick:()=>{m(e),h(e)},children:"Reset to today"}),null),l}}),null),s(b,r(C,{get when(){return L()},keyed:!0,children:l=>(()=>{var f=ft(),N=f.firstChild,E=N.nextSibling,H=E.nextSibling,ke=H.nextSibling;return s(E,()=>l.start),s(ke,()=>l.end),f})()}),null),s(u,r(C,{get when(){return v.isLoading},fallback:null,get children(){return ut()}}),$),s(u,r(C,{get when(){return v.isError},fallback:null,get children(){return gt()}}),$),s(u,r(Re,{get children(){return[r(Oe,{children:"List of competitions"}),r(qe,{get children(){return r(J,{get children(){return[r(ne,{children:"Name"}),r(ne,{})]}})}}),r(Ee,{get children(){return r(z,{get each(){return v.data?.pages.flatMap(l=>l.competitions)??[]},children:l=>r(C,{get when(){return l.itemType==="event"},get fallback(){return r(St,{competition:l})},get children(){return r(wt,{competition:l})}})})}})]}}),$),s($,r(C,{get when(){return v.isFetchingNextPage},get fallback(){return vt()},get children(){return mt()}}),null),s($,r(R,{class:"px-4 py-2 bg-blue-600 text-white rounded disabled:opacity-50",get disabled(){return!v.hasNextPage||v.isFetchingNextPage},onClick:()=>v.fetchNextPage(),children:"Load more"}),null),u})()}function wt(e){const n=/^[0-9]+$/.test(e.competition.id);return r(J,{get children(){return[r(U,{get children(){var t=bt(),o=t.firstChild,a=o.nextSibling,c=a.firstChild,d=a.nextSibling,i=d.firstChild,m=i.nextSibling,g=d.nextSibling,h=g.firstChild;return s(o,()=>n?r(Fe,{to:"/competition/$competitionId",get params(){return{competitionId:e.competition.id}},class:"text-primary hover:underline",get children(){return e.competition.name}}):e.competition.name),s(a,r(he,{}),c),s(c,()=>new Date(e.competition.timestamp).toLocaleString()),s(d,r(He,{}),i),s(i,()=>e.competition.course??"-"),s(d,r(C,{get when(){return ge(()=>!!e.competition.course)()&&e.competition.location},get children(){return ht()}}),m),s(m,()=>e.competition.location??"-"),s(g,r(ye,{}),h),s(h,()=>e.competition.playerCount??"-"),s(t,r(C,{get when(){return e.competition.comments},children:w=>(()=>{var v=Pe(),y=v.firstChild;return s(v,r(be,{}),y),s(y,w),v})()}),null),t}}),r(U,{class:"text-right",get children(){return r(C,{get when(){return e.competition.type},children:t=>r(ve,{variant:"outline",get children(){return t()}})})}})]}})}function St(e){return r(J,{get children(){return[r(U,{get children(){var n=yt(),t=n.firstChild,o=t.nextSibling,a=o.firstChild,c=a.firstChild,d=o.nextSibling,i=d.firstChild;return s(t,()=>e.competition.name),s(o,r(he,{}),a),s(a,()=>new Date(e.competition.rangeStart).toLocaleDateString(),c),s(a,()=>new Date(e.competition.rangeEnd).toLocaleDateString(),null),s(d,r(ye,{}),i),s(i,()=>e.competition.playerCount??"-"),s(n,r(C,{get when(){return e.competition.comments},children:m=>(()=>{var g=Pe(),h=g.firstChild;return s(g,r(be,{}),h),s(h,m),g})()}),null),n}}),r(U,{class:"text-right",get children(){return r(C,{get when(){return e.competition.type},children:n=>r(ve,{variant:"outline",get children(){return n()}})})}})]}})}export{Tt as component};
